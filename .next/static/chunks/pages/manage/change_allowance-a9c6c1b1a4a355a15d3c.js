_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[20],{ht1G:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/manage/change_allowance",function(){return a("m/19")}])},"m/19":function(e,t,a){"use strict";a.r(t);var n=a("o0o1"),s=a.n(n),r=a("HaE+"),o=a("1OyB"),l=a("vuIU"),u=a("JX7q"),i=a("Ji7U"),c=a("md7G"),d=a("foSv"),h=a("rePB"),p=a("q1tI"),m=a.n(p),f=a("5Yp1"),v=a("8Kt/"),g=a.n(v),w=a("ikXu"),b=a("QetY"),y=a("NNTU"),C=a("yE/o"),k=a("aQu0"),x=a("+6Dn"),A=a("vFsZ"),B=a("umxb"),S=a("pLir"),R=a("TbSc"),E=a("NrgV"),j=a("yo71"),O=a("oZBQ"),H=a("JZpj"),I=a("kB5k"),_=a.n(I),T=a("8cHP"),N=m.a.createElement;function L(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=Object(d.a)(e);if(t){var s=Object(d.a)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return Object(c.a)(this,a)}}var V,P,F,G,M,J,K,U,X,D,Y=[{key:"GCRB",text:"GCRB (1e+9)",value:"1e+9"},{key:"MCRB",text:"MCRB (1e+6)",value:"1e+6"},{key:"kCRB",text:"kCRB (1000)",value:"1000"},{key:"CRB",text:"CRB (1)",value:"1"},{key:"mCRB",text:"mCRB (0.001)",value:"0.001"},{key:"\xb5CRB",text:"\xb5CRB (1e-6)",value:"1e-6"},{key:"nCRB",text:"nCRB (1e-9)",value:"1e-9"},{key:"pCRB",text:"pCRB (1e-12)",value:"1e-12"},{key:"fCRB",text:"fCRB (1e-15)",value:"1e-15"},{key:"aCRB",text:"aCRB (1e-18)",value:"1e-18"}],q={},Q=function(e){Object(i.a)(a,e);var t=L(a);function a(){var e;Object(o.a)(this,a);for(var n=arguments.length,l=new Array(n),i=0;i<n;i++)l[i]=arguments[i];return e=t.call.apply(t,[this].concat(l)),Object(h.a)(Object(u.a)(e),"state",{mounted:!1,headerHeight:0,pausedHeight:0,allowancesLoaded:!1,speAddr:"",amount:"",speAddrErr:!1,amountErr:!1,msgErr:"",loading:!1,succes:!0,dropdownValue:"1",dropdownKey:"CRB"}),Object(h.a)(Object(u.a)(e),"getCryptoByteInfo",Object(r.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,H.a.methods.decimals().call();case 2:return G=e.sent,e.next=5,H.a.methods.symbol().call();case 5:return M=e.sent,e.next=8,O.a.eth.getAccounts();case 8:"undefined"!==typeof(J=e.sent[0])&&(F=!0);case 10:case"end":return e.stop()}}),e)})))),Object(h.a)(Object(u.a)(e),"getAllowanceInfo",Object(r.a)(s.a.mark((function t(){var a,n,r,o,l;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.setState({allowancesLoaded:!1}),!F){t.next=14;break}return t.next=4,H.a.getPastEvents("Approval",{fromBlock:0,toBlock:"latest",filter:{owner:J}});case 4:a=t.sent,n=0;case 6:if(!(n<a.length)){t.next=13;break}return t.next=9,H.a.methods.allowance(J,a[n].returnValues.spender).call();case 9:q[a[n].returnValues.spender]=t.sent;case 10:n++,t.next=6;break;case 13:for(r=0,o=Object.keys(q);r<o.length;r++)l=o[r],"0"===q[l]&&delete q[l];case 14:e.setState({allowancesLoaded:!0});case 15:case"end":return t.stop()}}),t)})))),Object(h.a)(Object(u.a)(e),"renderAllowances",(function(){var t=[],a=function(a){t.push(N(w.a.Row,{key:a},N(w.a.Cell,{style:{overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"}},N(T.Link,{href:"/account/".concat(a)},N("a",{title:a},a))),N(w.a.Cell,{title:q[a]/Math.pow(10,G)},(q[a]/Math.pow(10,G)).toLocaleString("en-US")+" "+M),N(w.a.Cell,null,N(b.a,{fluid:!0,onClick:function(){e.setState({speAddr:a,speAddrErr:!1})},style:{overflow:"auto"}},"Change this address' allowance"))))};for(var n in q)a(n);return t.length>0?N(w.a.Body,null,t):N(w.a.Body,null,N(w.a.Row,null,N(w.a.Cell,{colSpan:"3"},"Looks like you don't allow anyone any ",M,".")))})),Object(h.a)(Object(u.a)(e),"onSubmit",Object(r.a)(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.setState({loading:!0,msgErr:"",success:!1}),t.prev=1,!e.state.speAddrErr&&""!==e.state.speAddr){t.next=4;break}throw{message:"Invalid spender address."};case 4:if(!e.state.amountErr&&""!==e.state.amount){t.next=6;break}throw{message:"Amount must be a positive number."};case 6:if(K=_()(e.state.amount),U=_()(e.state.dropdownValue),X=_()("1e+"+G),U=U.times(X),K=K.times(U),D=_()(q[O.a.utils.toChecksumAddress(e.state.speAddr)]),!K.isGreaterThan(D)){t.next=17;break}return t.next=15,H.a.methods.increaseAllowance(O.a.utils.toChecksumAddress(e.state.speAddr),K.minus(D).toFixed()).send({from:J});case 15:t.next=28;break;case 17:if(!K.isLessThan(D)){t.next=22;break}return t.next=20,H.a.methods.decreaseAllowance(O.a.utils.toChecksumAddress(e.state.speAddr),D.minus(K).toFixed()).send({from:J});case 20:t.next=28;break;case 22:if(!K.isEqualTo(D)){t.next=26;break}throw{message:"New amount is the same as current amount."};case 26:return t.next=28,H.a.methods.approve(O.a.utils.toChecksumAddress(e.state.speAddr),K.toFixed()).send({from:J});case 28:e.setState({loading:!1,success:!0}),e.getAllowanceInfo(),t.next=35;break;case 32:t.prev=32,t.t0=t.catch(1),e.setState({loading:!1,msgErr:t.t0.message});case 35:case"end":return t.stop()}}),t,null,[[1,32]])})))),Object(h.a)(Object(u.a)(e),"updateContent",(function(){e.setState({headerHeight:V.clientHeight})})),Object(h.a)(Object(u.a)(e),"numberWithCommas",(function(e){var t=e.split(".");return t[0]=t[0].replace(/^0+/,""),t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),""===t[0]&&(t[0]="0"),t.join(".")})),e}return Object(l.a)(a,[{key:"componentDidMount",value:function(){var e=Object(r.a)(s.a.mark((function e(){var t,a=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return V=document.getElementById("header"),t=setInterval((function(){"visible"===V.style.visibility&&(P=document.getElementById("pausedmsg"),a.setState({headerHeight:V.clientHeight,pausedHeight:P.clientHeight}),clearInterval(t))}),100),window.addEventListener("pausedClosed",(function(e){a.setState({pausedHeight:0})})),e.next=5,this.getCryptoByteInfo();case 5:return this.setState({mounted:!0}),e.next=8,this.getAllowanceInfo();case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return N(f.a,{mounted:this.state.mounted},N(g.a,null,N("title",null,"Crypto Byte - Change allowance")),N(j.a,null),N(y.a,{onUpdate:this.updateContent},N(C.a,{style:{marginTop:this.state.pausedHeight?20:this.state.headerHeight+20}},N(k.a,{as:"h3",inverted:!0,dividing:!0,textAlign:"center"},"You can change the amount of tokens, that you allow another account to spend with the form below."),N(x.a,{stackable:!0,divided:!0,inverted:!0},N(x.a.Row,{columns:2},N(x.a.Column,null,N(A.a,{inverted:!0,onSubmit:this.onSubmit},N(A.a.Input,{error:this.state.speAddrErr,label:"Spender address"},N(B.a,{placeholder:"0x0000000000000000000000000000000000000000",value:this.state.speAddr,onChange:function(t){e.setState({speAddr:t.target.value}),t.target.value.match(/^(0x||0X)[a-fA-F0-9]{40}$/g)||""===t.target.value?e.setState({speAddrErr:!1}):e.setState({speAddrErr:{content:"Please enter a valid address."}})}})),N(A.a.Input,{label:"Amount to approve",error:this.state.amountErr,style:{width:"90%"}},N(B.a,{placeholder:"123.456",label:N(S.a,{scrolling:!0,value:this.state.dropdownValue,options:Y,onChange:function(t,a){e.setState({dropdownValue:a.value,dropdownKey:a.options.find((function(e){return e.value===a.value})).key})}}),labelPosition:"right",value:this.state.amount,onChange:function(t){e.setState({amount:t.target.value}),(isNaN(t.target.value)||parseFloat(t.target.value)<0||"0x"===t.target.value.substring(0,2))&&""!==t.target.value?e.setState({amountErr:{content:"The amount must be a positive number."}}):e.setState({amountErr:!1})}})),this.state.amount&&this.state.speAddr&&!this.state.amountErr&&!this.state.speAddrErr&&N(R.a,{info:!0,style:{overflow:"auto"}},N("p",null,"This is going to change your allowance to address"," ",N("b",null,O.a.utils.toChecksumAddress(this.state.speAddr))," ","from"," ",N("b",null,q[O.a.utils.toChecksumAddress(this.state.speAddr)]?this.numberWithCommas((q[O.a.utils.toChecksumAddress(this.state.speAddr)]/Math.pow(10,G)/this.state.dropdownValue).toString()):0," ",this.state.dropdownKey)," ","to"," ",N("b",null,this.numberWithCommas(this.state.amount)," ",this.state.dropdownKey),".")),this.state.msgErr&&N("div",null,N(R.a,{negative:!0,compact:!0},N(R.a.Header,null,"Something went wrong!"),this.state.msgErr),N("br",null)),this.state.success&&N("div",null,N(R.a,{positive:!0,compact:!0},N(R.a.Header,null,"Transaction complete!"),"The transaction was completed successfully."),N("br",null)),N(b.a,{type:"submit",loading:this.state.loading,disabled:this.state.loading},"Submit"))),N(x.a.Column,null,N(w.a,{unstackable:!0,inverted:!0,striped:!0,celled:!0,fixed:!0},N(w.a.Header,null,N(w.a.Row,null,N(w.a.HeaderCell,{colSpan:"3"},"You currently allow ",M," to:")),N(w.a.Row,{columns:2},N(w.a.HeaderCell,{textAlign:"center"},"Address"),N(w.a.HeaderCell,{textAlign:"center"},"Value"),N(w.a.HeaderCell,null))),this.state.allowancesLoaded?this.renderAllowances():N(w.a.Body,null,N(w.a.Row,null,N(w.a.Cell,{colSpan:"3"},N(E.a,{active:!0,inline:"centered",inverted:!0})))))))))))}}]),a}(p.Component);t.default=Q}},[["ht1G",0,1,2,3,4,6,7,8]]]);